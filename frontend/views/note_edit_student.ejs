<%- include('partials/header', { title: 'Modifier les notes - ' + matricule }) %>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Modifier les notes - <%= matricule %></h2>
  <a href="/notes" class="btn btn-secondary"><i class="fas fa-arrow-left me-1"></i>Retour</a>
</div>

<div class="alert alert-info">
  <i class="fas fa-info-circle me-2"></i>
  <strong>Session :</strong> <%= session %> | <strong>Matricule :</strong> <%= matricule %>
</div>

<div class="row mb-3">
  <div class="col-md-6">
    <label class="form-label">Type d'évaluation *</label>
    <select name="type_evaluation" class="form-select" required>
      <option value="">Sélectionner un type</option>
      <option value="Controle Continu" <%= selectedType === 'Controle Continu' ? 'selected' : '' %>>Controle Continu</option>
      <option value="Examen" <%= selectedType === 'Examen' ? 'selected' : '' %>>Examen</option>
    </select>
  </div>
</div>

<form method="post" action="/notes/edit-student/<%= matricule %>/<%= session %>" id="notesForm">
  <div class="card">
    <div class="card-header">
      <h5 class="card-title mb-0"><i class="fas fa-table me-2"></i>Modification des notes par matière</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-striped notes-table">
          <thead class="table-dark">
            <tr>
              <th style="width: 30%;">Matière</th>
              <th style="width: 20%;">Note (sur 20)</th>
              <th style="width: 50%;">Commentaire</th>
            </tr>
          </thead>
          <tbody>
            <% matieres.forEach(function(matiere) { %>
              <tr>
                <td><strong><%= matiere %></strong></td>
                <td>
                  <input type="number" 
                         name="notes[<%= matiere %>][note]" 
                         class="form-control" 
                         min="0" 
                         max="20" 
                         step="0.5" 
                         value="<%= notesByMatiere[matiere] ? notesByMatiere[matiere].note : '' %>"
                         placeholder="Ex: 15.5">
                </td>
                <td>
                  <input type="text" 
                         name="notes[<%= matiere %>][commentaire]" 
                         class="form-control" 
                         value="<%= notesByMatiere[matiere] ? notesByMatiere[matiere].commentaire : '' %>"
                         placeholder="Commentaire optionnel">
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <button type="submit" class="btn btn-success btn-lg">
      <i class="fas fa-save me-2"></i>Enregistrer les modifications
    </button>
    <button type="button" class="btn btn-warning btn-lg ms-2" onclick="clearForm()">
      <i class="fas fa-eraser me-2"></i>Effacer le formulaire
    </button>
    <a href="/notes" class="btn btn-secondary btn-lg ms-2">
      <i class="fas fa-times me-2"></i>Annuler
    </a>
  </div>
</form>

<script>
function clearForm() {
  if (confirm('Êtes-vous sûr de vouloir effacer tous les champs ?')) {
    document.getElementById('notesForm').reset();
  }
}

// Validation côté client
document.getElementById('notesForm').addEventListener('submit', function(e) {
  // Vérifier qu'au moins une note est saisie
  const noteInputs = document.querySelectorAll('input[name*="[note]"]');
  let hasNotes = false;
  
  noteInputs.forEach(input => {
    if (input.value && input.value.trim() !== '') {
      hasNotes = true;
    }
  });
  
  if (!hasNotes) {
    e.preventDefault();
    alert('Veuillez saisir au moins une note.');
    return;
  }
});
</script>

<style>
.table th {
  background: #667eea !important;
  color: white;
  font-weight: 600;
  border: none;
  padding: 15px 12px;
}

.table td {
  padding: 12px;
  vertical-align: middle;
  border-color: #e9ecef;
}

.table tbody tr:hover {
  background-color: #f8f9fa;
}

.form-control {
  border-radius: 8px;
  border: 2px solid #e9ecef;
  transition: all 0.3s ease;
}

.form-control:focus {
  border-color: #667eea;
  box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.btn {
  border-radius: 8px;
  font-weight: 500;
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

/* Responsive */
@media (max-width: 768px) {
  .table-responsive {
    font-size: 0.85rem;
  }
  
  .btn {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }
}
</style>

<%- include('partials/footer') %>




